---
name: tech-stack
type: tech
updated: "2026-02-25"
summary: "TypeScript CLI (Node 18+, ESM) + Node HTTP server + React 19/Vite 6 dashboard. CLI bundled by tsup; dashboard built by Vite, output copied to dist/dashboard/."
---

## Tech Stack

TypeScript 5.7, Node.js >= 18, ESM-only npm package. CLI + local HTTP server + React SPA dashboard.

## Architecture Overview

Single-binary CLI tool that can also serve a local web dashboard. No external services. All state lives on the local filesystem in `_agent_context/` directories within user projects.

**Source layout**:
```
src/
├── cli/
│   ├── index.ts              # Entry point, banner, interactive mode, program setup
│   ├── interactive.ts        # readline REPL for no-args mode
│   └── commands/
│       ├── init.ts           # agentcontext init
│       ├── core.ts           # agentcontext core {changelog,releases}
│       ├── features.ts       # agentcontext features {create,update_properties,insert}
│       ├── tasks.ts          # agentcontext tasks {create,update,complete,log}
│       ├── knowledge.ts      # agentcontext knowledge {create,update}
│       ├── sleep.ts          # agentcontext sleep {status,add,done,debt}
│       ├── hook.ts           # agentcontext hook {session-start,stop}
│       ├── snapshot.ts       # agentcontext snapshot (plain-text context dump for SessionStart hook)
│       ├── dashboard.ts      # agentcontext dashboard (starts HTTP server + opens browser)
│       └── install-skill.ts  # agentcontext install-skill (copies skill+agents to .claude/)
├── server/
│   ├── index.ts              # createServer(), startDashboardServer(), route registration
│   ├── router.ts             # URL pattern matching with :param extraction
│   ├── middleware.ts         # JSON parsing, CORS
│   ├── static.ts             # Serves dashboard/dist/ static files
│   ├── change-tracker.ts     # recordDashboardChange() writes to .sleep.json dashboard_changes
│   └── routes/
│       ├── tasks.ts          # GET/POST/PATCH/DELETE /api/tasks
│       ├── sleep.ts          # GET/POST /api/sleep
│       ├── core.ts           # GET/PUT /api/core
│       ├── knowledge.ts      # GET/PATCH /api/knowledge
│       ├── features.ts       # GET /api/features
│       ├── changelog.ts      # GET /api/changelog, GET /api/releases/unreleased, GET /api/releases/:version, POST /api/releases
│       └── health.ts         # GET /api/health
└── lib/
    ├── context-path.ts       # _agent_context/ root resolution (walk-up, MAX_WALK_UP=5)
    ├── frontmatter.ts        # gray-matter wrappers
    ├── markdown.ts           # Section-level operations: readSection, insertToSection, listSections
    ├── json-file.ts          # JSON array + object CRUD
    ├── search.ts             # Keyword search
    ├── id.ts                 # generateId, slugify, today
    ├── format.ts             # CLI output formatting
    ├── core-index.ts         # Scans core/[3-9]* files for snapshot
    ├── knowledge-index.ts    # Scans knowledge/*.md frontmatter for snapshot
    ├── release-discovery.ts  # Auto-discovers unreleased tasks/features/changelog for releases add
    └── release-backpopulate.ts  # Sets released_version on features when bundled into a release

dashboard/                    # Separate package (own package.json)
├── src/
│   ├── App.tsx               # React root with QueryClient, Theme, I18n providers, ErrorBoundary
│   ├── api/client.ts         # Fetch wrapper with res.ok checks and error parsing
│   ├── styles/tokens.css     # Design tokens (colors, spacing, typography)
│   ├── styles/global.css     # Base styles, brand gradient background, stagger entrance animations
│   ├── pages/                # Tasks, Sleep, Core, Knowledge, Features pages
│   ├── components/           # KanbanBoard, TaskDetail, CoreEditor, KnowledgeCard, SqlPreview, etc.
│   ├── lib/sql-parser.ts     # Parses SQL CREATE TABLE + comment-based schemas, extracts entities/fields/relationships
│   ├── hooks/                # TanStack Query hooks (useTasks, useSleep, useCore, etc.)
│   └── contexts/             # ThemeContext, I18nContext
└── dist/                     # Vite build output (copied to dist/dashboard/ by tsup)
```

**Distributed assets** (not TypeScript, shipped alongside dist):
```
skill/
└── SKILL.md                  # Claude Code skill (alwaysApply: true, SessionStart hook)
agents/
├── agentcontext-initializer.md  # Sub-agent for bootstrapping _agent_context/
└── agentcontext-rem-sleep.md    # Sub-agent for memory consolidation
src/templates/init/           # Template files for agentcontext init
dist/dashboard/               # React SPA (copied from dashboard/dist/ on build)
```

## Key Dependencies

**CLI runtime** (all externalized from bundle):
- `commander@^13.1.0` — CLI argument parsing and subcommand structure
- `chalk@^5.4.1` — Terminal colors. v5+ is ESM-only.
- `gray-matter@^4.0.3` — YAML frontmatter parsing and serialization.
- `@inquirer/prompts@^7.10.1` — Interactive prompts.
- `fast-glob@^3.3.3` — File system glob matching.
- `nanoid@^5.1.2` — Unique ID generation.

**Dashboard runtime** (separate `dashboard/package.json`, not in CLI bundle):
- `react@^19` + `react-dom@^19` — UI framework
- `@tanstack/react-query@^5` — Server state management
- `vite@^6` + `@vitejs/plugin-react@^4` — Build tool and dev server

**Dev**:
- `tsup@^8.4.0` — Bundles CLI + server to `dist/index.js`. Copies `dashboard/dist/` to `dist/dashboard/` via `onSuccess`.
- `typescript@^5.7.3` — Strict mode.
- `vitest@^3.0.6` — Test runner (unit + integration).
- `@types/node@^22.13.4` — Node.js type definitions.

## Build Pipeline

```
npm run build
  └─ build:dashboard   →  vite build in dashboard/ → dashboard/dist/
  └─ build:cli         →  tsup src/cli/index.ts + src/server/ → dist/index.js
                           onSuccess: cp dashboard/dist/ → dist/dashboard/
```

## Infrastructure

- **Distribution**: npm public registry as `agentcontext` package.
- **Install**: `npm install -g agentcontext` for global use.
- **Build output**: `dist/` (ESM `dist/index.js` + `dist/templates/` + `dist/agents/` + `dist/dashboard/`).
- **Dashboard**: Served locally on port 4173 (configurable). Not daemonized. Runs until Ctrl+C.
- **No CI/CD configured yet**: Manual publish via `npm publish`.
- **Testing**: vitest. Integration tests execute the compiled binary via `execSync`. 325 tests passing (2 pre-existing flaky).
