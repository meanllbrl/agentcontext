---
name: "agentcontext"
type: soul
updated: "2026-02-25"
---

## Project Identity

agentcontext is a TypeScript CLI tool published as an npm package that gives AI coding agents a structured, persistent brain across sessions. The core problem it solves is not that agents "forget" — it's that every session triggers a token-burning search spiral: the agent reads a flat memory file, finds it insufficient for a complex codebase, and burns 20K+ tokens in tool calls re-exploring structure it already knew. agentcontext eliminates this by pre-loading structured context via a SessionStart hook (zero agent tool calls), organizing knowledge across purpose-built files mirroring brain regions (soul/identity, user/episodic, memory/semantic, knowledge/procedural, state/working), and consolidating knowledge during a RemSleep cycle that mirrors how the brain processes memory during sleep.

The tool ships with a SKILL.md (auto-loaded by Claude Code via `alwaysApply: true`) and two sub-agents: an initializer for bootstrapping and a rem-sleep agent for memory consolidation. Three Claude Code hooks are registered: SessionStart (context injection + sleep debt), Stop (transcript recording), and SubagentStart (lightweight briefing for all sub-agents). Currently supports Claude Code only; multi-agent support is a future goal.

## Target User

Developers using Claude Code (and eventually other AI coding agents) who work on non-trivial projects where losing session context is painful. Also developers building on top of the agentcontext system itself.

## Current Priority

Complete the web dashboard (Phase 5: accessibility, responsive polish, bundle audit), then publish v0.1.0 to npm. Phase 1-4 implemented: Node HTTP server with 17 API endpoints, React 19 + Vite 6 dashboard with Kanban, sleep state, core editor, knowledge manager, features viewer, SQL ER diagram preview. Error handling and loading states added (Phase 4 complete). 313 tests passing (10 commands). Dashboard ships in the npm package at dist/dashboard/.

## Core Principles

- **Context should be cheap to load**: `agentcontext snapshot` must be fast and produce a compact, high-signal output. No bloat.
- **CLI > agent editing files directly**: Structural operations (create, insert, search) go through the CLI. The CLI handles frontmatter, LIFO ordering, section parsing — the agent doesn't need to care.
- **Native tools for direct edits**: Read, Edit, Write for direct file reads and replacements. CLI for structural operations. Never use the CLI when a direct edit is faster.
- **LIFO ordering everywhere**: Changelogs, memory entries, constraints — newest at top. Always.
- **~200 line limit on core files**: If a file gets too large, extract to knowledge and keep summary + reference. The sleep agent enforces this.
- **No sub-agent proliferation**: The skill is the skill. No nested `.claude/` configs, no agent per command. Keep it flat.
- **No placeholders**: Empty context files are worse than no context files. Template placeholders like "(Add your principles here)" are a failure state.

## Constraints

- **Node.js >= 18 required**: The package uses ESM, native `node:fs`, `node:path` — no polyfills.
- **ESM-only package**: `"type": "module"` in package.json. All imports use `.js` extensions even for TypeScript source.
- **External dependencies not bundled**: tsup config explicitly externalizes all runtime deps (commander, chalk, gray-matter, @inquirer/prompts, fast-glob, nanoid). They are installed via node_modules.
- **Templates must ship with dist**: tsup `onSuccess` copies `src/templates` to `dist/templates`. If this breaks, `agentcontext init` silently creates minimal stubs.
- **Claude Code only (v0.1.0)**: The skill and agents are written for Claude's tool format. Other agents (Gemini CLI, etc.) are not yet supported.
- **Single bin entry**: The package exposes one binary: `agentcontext`. No sub-binaries.
- **Dashboard deps are isolated**: `dashboard/` has its own `package.json`. React, Vite, TanStack Query are devDependencies of the dashboard only. They are NOT in the CLI's `package.json` and must never be imported from `src/`.
- **Visby CF font is commercial**: The dashboard uses Visby CF as the brand font. The CSS falls back to system fonts if not installed. Do not embed the font files in the npm package.

## Agent Behaviors & Rules

- Always run `npm test` before considering a change complete. Tests live in `tests/unit/` (vitest, no build needed) and `tests/integration/` (requires `npm run build` first — they run against `dist/index.js`). `npm run build` now means `build:dashboard` + `build:cli`.
- When adding a new command, register it in `src/cli/index.ts` via `registerXyzCommand(program)` and add it to the command reference table in `skill/SKILL.md`.
- The dashboard (`src/server/` + `dashboard/`) is a separate build target. Server code is bundled with tsup alongside the CLI. React app is built by Vite in `dashboard/` and copied to `dist/dashboard/` by tsup's `onSuccess`. Do not import React or Vite dependencies from `src/` — they live in `dashboard/` only.
- Template files at `src/templates/init/` are processed with token substitution (`{{PROJECT_NAME}}`, `{{DATE}}`, etc.). When changing template structure, update `init.ts` tokens accordingly.
- Core file aliases are defined in `src/cli/commands/core.ts` in `CORE_ALIASES`. Adding a new core file means adding it there. Extended core files are numbered 3-5 (style_guide, tech_stack, data_structures). Slot 6+ is intentionally open for user customization.
- The `snapshot` command must remain plain-text, no chalk colors — it's consumed by the SessionStart hook programmatically. The `hook subagent-start` command outputs JSON (`{"hookSpecificOutput":{"hookEventName":"SubagentStart","additionalContext":"..."}}`) per Claude Code's SubagentStart hook spec. Do not conflate these formats.
- Search is keyword-based (tokenize + substring match), not semantic. Score weighting: name +3, tags +2, description +1, content +0.5. Don't switch to semantic search without considering performance impact on large projects.
- File resolution for tasks and features uses exact → prefix → substring match via `slugify()`. Keep this consistent.
- **Features are core, not scope creep**: Feature PRDs (with user stories, acceptance criteria, constraints) give the agent complete context when fixing bugs or building features. Solo developers don't use Jira/Linear — agentcontext fills that gap intentionally.
- **SKILL.md token cost is accepted**: SKILL.md sits at ~510 lines. The token investment pays off with proper state management. Trimming to 200 lines was a previous goal, now deprioritized.
- **Pre-publish remaining work**: Publish v0.1.0 to npm after Phase 5 dashboard polish. 313 tests passing with 2 pre-existing flaky tests (id.test.ts nanoid intermittent + snapshot changelog test). 10 commands total.

## Warnings & Non-Negotiables

- Never bundle runtime dependencies into the dist. The tsup config externalizes them deliberately. Bundling chalk or commander causes issues with chalk's ESM detection and adds significant size.
- Never add `--no-verify` to git operations or skip pre-commit hooks.
- Never make the `snapshot` command use chalk or interactive prompts. It is consumed by a shell hook — it must be pure stdout text.
- Never change `insertToJsonArray` default position from `'top'` (LIFO) without auditing all callers — CHANGELOG.json integrity depends on this.
- Do not add `.claude/` files, sub-agents, or skill configuration to this repo's own context. The skill and agents live in `skill/` and `agents/` for distribution — they are installed by `agentcontext install-skill` into consuming projects, not this one.

